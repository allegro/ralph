var Viva=Viva||{};Viva.Graph=Viva.Graph||{},Viva.Graph.version="1.0.0.42",Viva.random=function(){function e(){var e=4022871197,t=function(t){t=t.toString();for(var n=0;n<t.length;n++){e+=t.charCodeAt(n);var r=.02519603282416938*e;e=r>>>0,r-=e,r*=e,e=r>>>0,r-=e,e+=r*4294967296}return(e>>>0)*2.3283064365386963e-10};return t.version="Mash 0.9",t}function t(t){return function(t){var n=0,r=58,i=119,s=178,o,u=[],a=e();t.length===0&&(t=[+(new Date)]);for(o=0;o<256;o++)u[o]=a(" "),u[o]-=a(" ")*4.76837158203125e-7,u[o]<0&&(u[o]+=1);for(var f=0;f<t.length;f++)for(o=0;o<256;o++)u[o]-=a(t[f]),u[o]-=a(t[f])*4.76837158203125e-7,u[o]<0&&(u[o]+=1);a=null;var l=function(){var e;return n=n+1&255,r=r+1&255,i=i+1&255,s=s+1&255,e=u[n]-u[r],e<0&&(e+=1),e-=u[i],e<0&&(e+=1),e-=u[s],e<0&&(e+=1),u[n]=e,e};return l.uint32=function(){return l()*4294967296>>>0},l.fract53=l,l.version="LFIB4 0.9",l.args=t,l}(t)}var n=new t(Array.prototype.slice.call(arguments));return{next:function(e){return Math.floor(n()*e)},nextDouble:function(){return n()}}},Viva.randomIterator=function(e,t){return t=t||Viva.random(),{forEach:function(n){for(var r=e.length-1;r>0;--r){var i=t.next(r+1),s=e[i];e[i]=e[r],e[r]=s,n(s)}e.length&&n(e[0])},shuffle:function(){for(var n=e.length-1;n>0;--n){var r=t.next(n+1),i=e[r];e[r]=e[n],e[n]=i}return e}}},Viva.BrowserInfo=function(){if(typeof navigator=="undefined")return{browser:"",version:"0"};var e=navigator.userAgent,t=/(webkit)[ \/]([\w.]+)/,n=/(opera)(?:.*version)?[ \/]([\w.]+)/,r=/(msie) ([\w.]+)/,i=/(mozilla)(?:.*? rv:([\w.]+))?/;e=e.toLowerCase();var s=t.exec(e)||n.exec(e)||r.exec(e)||e.indexOf("compatible")<0&&i.exec(e)||[];return{browser:s[1]||"",version:s[2]||"0"}}(),Viva.Graph.Utils=Viva.Graph.Utils||{},Viva.Graph.Utils.indexOfElementInArray=function(e,t){if(t.indexOf)return t.indexOf(e);var n=t.length,r=0;for(;r<n;r++)if(r in t&&t[r]===e)return r;return-1},Viva.Graph.Utils=Viva.Graph.Utils||{},Viva.Graph.Utils.getDimension=function(e){if(!e)throw{message:"Cannot get dimensions of undefined container"};var t=e.clientWidth,n=e.clientHeight;return{left:0,top:0,width:t,height:n}},Viva.Graph.Utils.findElementPosition=function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return[t,n]},Viva.Graph.Utils=Viva.Graph.Utils||{},Viva.Graph.Utils.events=function(e){var t=function(e){var t={};return e.fire=function(e,n){var r,i,s;if(typeof e!="string")throw"Only strings can be used as even type";if(t.hasOwnProperty(e)){r=t[e];for(var o=0;o<r.length;++o)s=r[o],i=s.method,i(n)}return this},e.addEventListener=function(e,n){if(typeof n!="function")throw"Only functions allowed to be callbacks";var r={method:n};return t.hasOwnProperty(e)?t[e].push(r):t[e]=[r],this},e.removeEventListener=function(e,n){if(typeof n!="function")throw"Only functions allowed to be callbacks";if(t.hasOwnProperty(e)){var r=t[e];for(var i=0;i<r.length;++i)if(r[i].callback===n){r.splice(i);break}}return this},e};return{on:function(t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n),this},stop:function(t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},extend:function(){return t(e)}}},Viva.Graph.Utils=Viva.Graph.Utils||{},Viva.Graph.Utils.dragndrop=function(e){var t,n,r,i,s,o,u=Viva.Graph.Utils.events(window.document),a=Viva.Graph.Utils.events(e),f=Viva.Graph.Utils.findElementPosition,l=0,c=0,h,p=function(e){var t=0,n=0;e=e||window.event;if(e.pageX||e.pageY)t=e.pageX,n=e.pageY;else if(e.clientX||e.clientY)t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=e.clientY+document.body.scrollTop+document.documentElement.scrollTop;return[t,n]},d=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},v=function(e){return d(e),!1},m=function(e){e=e||window.event,n&&n(e,{x:e.clientX-l,y:e.clientY-c}),l=e.clientX,c=e.clientY},g=function(e){e=e||window.event;var n=e.button===1&&window.event!==null||e.button===0;if(n)return l=e.clientX,c=e.clientY,h=e.target||e.srcElement,t&&t(e,{x:l,y:c}),u.on("mousemove",m),u.on("mouseup",y),d(e),s=document.onselectstart,o=document.ondragstart,document.onselectstart=v,h.ondragstart=v,!1},y=function(e){e=e||window.event,u.stop("mousemove",m),u.stop("mouseup",y),document.onselectstart=s,h.ondragstart=o,h=null,r&&r()},b=function(t){if(typeof i!="function")return;t=t||window.event,t.preventDefault&&t.preventDefault(),t.returnValue=!1;var n,r=p(t),s=f(e),o={x:r[0]-s[0],y:r[1]-s[1]};t.wheelDelta?n=t.wheelDelta/360:n=t.detail/-9,i(t,n,o)},w=function(t){!i&&t?Viva.BrowserInfo.browser==="webkit"?e.addEventListener("mousewheel",b,!1):e.addEventListener("DOMMouseScroll",b,!1):i&&!t&&(Viva.BrowserInfo.browser==="webkit"?e.removeEventListener("mousewheel",b,!1):e.removeEventListener("DOMMouseScroll",b,!1)),i=t};return a.on("mousedown",g),{onStart:function(e){return t=e,this},onDrag:function(e){return n=e,this},onStop:function(e){return r=e,this},onScroll:function(e){return w(e),this},release:function(){u.stop("mousemove",m),u.stop("mousedown",g),u.stop("mouseup",y),w(null)}}},Viva.Input=Viva.Input||{},Viva.Input.domInputManager=function(e,t){return{bindDragNDrop:function(e,t){if(t){var n=Viva.Graph.Utils.dragndrop(e.ui);typeof t.onStart=="function"&&n.onStart(t.onStart),typeof t.onDrag=="function"&&n.onDrag(t.onDrag),typeof t.onStop=="function"&&n.onStop(t.onStop),e.events=n}else e.events&&(e.events.release(),e.events=null,delete e.events)}}},Viva.Graph.spatialIndex=function(e,t){var n,r,i=16;return typeof t=="function"?(r=t,n=function(t,n){var i=null;return e.forEachNode(function(e){var s=e.position;if(r(e,t,n))return i=e,!0}),i}):typeof t=="number"&&(i=t,n=function(t,n){var r=null;return e.forEachNode(function(e){var s=e.position;if(s.x-i<t&&t<s.x+i&&s.y-i<n&&n<s.y+i)return r=e,!0}),r}),{getNodeAt:n}},Viva.Graph.Utils=Viva.Graph.Utils||{},function(){var e=0,t=["ms","moz","webkit","o"];typeof window=="undefined"&&(window={});for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),Viva.Graph.Utils.timer=function(e,t){var n,r=function(){window.cancelAnimationFrame(n),n=0},i=function(){n=window.requestAnimationFrame(i),e()||r()};return i(),{stop:r,restart:function(){n||i()}}},Viva.Graph.geom=function(){return{intersect:function(e,t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m,g,y,b,w,E={x:0,y:0};return a=r-t,l=e-n,h=n*t-e*r,m=a*i+l*s+h,g=a*o+l*u+h,m!==0&&g!==0&&m>=0==g>=4?null:(f=u-s,c=i-o,p=o*s-i*u,d=f*e+c*t+p,v=f*n+c*r+p,d!==0&&v!==0&&d>=0==v>=0?null:(y=a*c-f*l,y===0?null:(b=y<0?-y/2:y/2,b=0,w=l*p-c*h,E.x=(w<0?w-b:w+b)/y,w=f*h-a*p,E.y=(w<0?w-b:w+b)/y,E)))},intersectRect:function(e,t,n,r,i,s,o,u){return this.intersect(e,t,e,r,i,s,o,u)||this.intersect(e,r,n,r,i,s,o,u)||this.intersect(n,r,n,t,i,s,o,u)||this.intersect(n,t,e,t,i,s,o,u)},convexHull:function(e){var t=function(e,t){var n=function(t){var n=t.x-e.x,r=t.y-e.y,i=n>0?1:-1;return i*n*n/(n*n+r*r)},r=t.sort(function(e,t){return n(t)-n(e)}),i=r[0],s=n(i),o=i.x-e.x,u=i.y-e.y,a=o*o+u*u,f;for(var l=1;l<r.length;++l){i=r[l];var c=n(i);c===s?(o=i.x-e.x,u=i.y-e.y,f=o*o+u*u,f<a?r.splice(l,1):r.splice(l-1,1)):s=c}return r},n=function(e,t,n){return(n.x-e.x)*(t.y-e.y)-(n.y-e.y)*(t.x-e.x)<0};if(e.length<3)return e;var r=0;for(var i=0;i<e.length;++i)e[i].y<e[r].y?r=i:e[i].y===e[r].y&&e[i].x<e[r].x&&(r=i);var s=e[r];e.splice(r,1);var o=t(s,e);if(o.length<2)return o;var u=[];u.push(s),u.push(o[0]),u.push(o[1]);var a=u.length;for(i=2;i<o.length;++i){while(!n(u[a-2],u[a-1],o[i]))u.pop(),a-=1;u.push(o[i]),a+=1}return u}}},Viva.Graph.Rect=function(e,t,n,r){this.x1=e||0,this.y1=t||0,this.x2=n||0,this.y2=r||0},Viva.Graph.Point2d=function(e,t){this.x=e||0,this.y=t||0},Viva.Graph.graph=function(){var e={},t=[],n=0,r=0,i=[],s=function(e){e.fire("changed",i)},o=function(e){r+=1},u=function(e){r-=1,r===0&&i.length>0&&(s(e),i.length=0)},a=function(e,t){i.push({node:e,changeType:t})},f=function(e,t){i.push({link:e,changeType:t})},l=function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&typeof e.splice=="function"&&!e.propertyIsEnumerable("length")},c={addNode:function(t,r){if(typeof t=="undefined")throw{message:"Invalid node identifier"};o();var i=this.getNode(t);i?a(i,"update"):(i={},i.links=[],i.id=t,n++,a(i,"add"));if(r){var s=i.data||{},f=typeof r;if(f==="string"||l(r)||f==="number"||f==="boolean")s=r;else if(f==="undefined")s=null;else for(var c in r)r.hasOwnProperty(c)&&(s[c]=r[c]);i.data=s}return e[t]=i,u(this),i},addLink:function(e,n,r){o();var i=this.getNode(e)||this.addNode(e),s=this.getNode(n)||this.addNode(n),a={fromId:e,toId:n,data:r};return t.push(a),i.links.push(a),s.links.push(a),f(a,"add"),u(this),a},removeLink:function(e){if(!e)return!1;var n=Viva.Graph.Utils.indexOfElementInArray(e,t);if(n<0)return!1;o(),t.splice(n,1);var r=this.getNode(e.fromId),i=this.getNode(e.toId);return r&&(n=Viva.Graph.Utils.indexOfElementInArray(e,r.links),n>=0&&r.links.splice(n,1)),i&&(n=Viva.Graph.Utils.indexOfElementInArray(e,i.links),n>=0&&i.links.splice(n,1)),f(e,"remove"),u(this),!0},removeNode:function(t){var r=this.getNode(t);if(!r)return!1;o();while(r.links.length){var i=r.links[0];this.removeLink(i)}e[t]=null,delete e[t],n--,a(r,"remove"),u(this)},getNode:function(t){return e[t]},getNodesCount:function(){return n},getLinksCount:function(){return t.length},getLinks:function(e){var t=this.getNode(e);return t?t.links:null},forEachNode:function(t){if(typeof t!="function")return;for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return},forEachLinkedNode:function(t,n,r){var i=this.getNode(t),s,o,u;if(i&&i.links&&typeof n=="function")if(r)for(s=0;s<i.links.length;++s)o=i.links[s],o.fromId===t&&n(e[o.toId],o);else for(s=0;s<i.links.length;++s)o=i.links[s],u=o.fromId===t?o.toId:o.fromId,n(e[u],o)},forEachLink:function(e){if(typeof e=="function")for(var n=0;n<t.length;++n)e(t[n])},beginUpdate:function(){o()},endUpdate:function(){u(this)},clear:function(){var e=this;e.beginUpdate(),e.forEachNode(function(t){e.removeNode(t.id)}),e.endUpdate()},hasLink:function(e,t){var n=this.getNode(e);if(!n)return null;for(var r=0;r<n.links.length;++r){var i=n.links[r];if(i.fromId===e&&i.toId===t)return i}return null}};return Viva.Graph.Utils.events(c).extend(),c},Viva.Graph.generator=function(){return{complete:function(e){if(!e||e<1)throw{message:"At least two nodes expected for complete graph"};var t=Viva.Graph.graph();t.Name="Complete K"+e;for(var n=0;n<e;++n)for(var r=n+1;r<e;++r)n!==r&&t.addLink(n,r);return t},completeBipartite:function(e,t){if(!e||!t||e<0||t<0)throw{message:"Graph dimensions are invalid. Number of nodes in each partition should be greate than 0"};var n=Viva.Graph.graph();n.Name="Complete K "+e+","+t;for(var r=0;r<e;++r)for(var i=e;i<e+t;++i)n.addLink(r,i);return n},ladder:function(e){if(!e||e<0)throw{message:"Invalid number of nodes"};var t=Viva.Graph.graph();t.Name="Ladder graph "+e;for(var n=0;n<e-1;++n)t.addLink(n,n+1),t.addLink(e+n,e+n+1),t.addLink(n,e+n);return t.addLink(e-1,2*e-1),t},circularLadder:function(e){if(!e||e<0)throw{message:"Invalid number of nodes"};var t=this.ladder(e);return t.Name="Circular ladder graph "+e,t.addLink(0,e-1),t.addLink(e,2*e-1),t},grid:function(e,t){var n=Viva.Graph.graph();n.Name="Grid graph "+e+"x"+t;for(var r=0;r<e;++r)for(var i=0;i<t;++i){var s=r+i*e;r>0&&n.addLink(s,r-1+i*e),i>0&&n.addLink(s,r+(i-1)*e)}return n},path:function(e){if(!e||e<0)throw{message:"Invalid number of nodes"};var t=Viva.Graph.graph();t.Name="Path graph "+e,t.addNode(0);for(var n=1;n<e;++n)t.addLink(n-1,n);return t},lollipop:function(e,t){if(!t||t<0||!e||e<0)throw{message:"Invalid number of nodes"};var n=this.complete(e);n.Name="Lollipop graph. Head x Path "+e+"x"+t;for(var r=0;r<t;++r)n.addLink(e+r-1,e+r);return n},balancedBinTree:function(e){var t=Viva.Graph.graph();t.Name="Balanced bin tree graph "+e;var n=Math.pow(2,e);for(var r=1;r<n;++r){var i=r,s=i*2,o=i*2+1;t.addLink(i,s),t.addLink(i,o)}return t},randomNoLinks:function(e){if(!e||e<0)throw{message:"Invalid number of nodes"};var t=Viva.Graph.graph();t.Name="Random graph, no Links: "+e;for(var n=0;n<e;++n)t.addNode(n);return t}}},Viva.Graph.operations=function(){return{density:function(e){var t=e.getNodesCount();return t===0?NaN:2*e.getLinksCount()/(t*(t-1))}}},Viva.Graph.centrality=function(){"use strict";var e=function(e,t,n){var r={},i=[],s={},o={},u=[t.id],a,f,l,c=function(e){o.hasOwnProperty(e.id)||(u.push(e.id),o[e.id]=f+1),o[e.id]===f+1&&(s[e.id]+=l,r[e.id].push(a))};e.forEachNode(function(e){r[e.id]=[],s[e.id]=0}),o[t.id]=0,s[t.id]=1;while(u.length)a=u.shift(),f=o[a],l=s[a],i.push(a),e.forEachLinkedNode(a,c,n);return{S:i,P:r,sigma:s}},t=function(e,t,n){var r={},i=t.S,s,o,u,a,f;for(s=0;s<i.length;s+=1)r[i[s]]=0;while(i.length){o=i.pop(),u=(1+r[o])/t.sigma[o],a=t.P[o];for(s=0;s<a.length;s+=1)f=a[s],r[f]+=t.sigma[f]*u;o!==n&&(e[o]+=r[o])}},n=function(e){var t=[],n;for(n in e)e.hasOwnProperty(n)&&t.push({key:n,value:e[n]});return t.sort(function(e,t){return t.value-e.value})};return{betweennessCentrality:function(r,i){var s={},o;return r.forEachNode(function(e){s[e.id]=0}),r.forEachNode(function(n){o=e(r,n),t(s,o,n)}),n(s)},degreeCentrality:function(e,t){var n,r=[],i=[];t=(t||"both").toLowerCase();if(t==="in")n=function(e,t){var n=0,r;for(r=0;r<e.length;r+=1)n+=e[r].toId===t?1:0;return n};else if(t==="out")n=function(e,t){var n=0,r;for(r=0;r<e.length;r+=1)n+=e[r].fromId===t?1:0;return n};else{if(t!=="both")throw"Expected centrality degree kind is: in, out or both";n=function(e,t){return e.length}}e.forEachNode(function(t){var i=e.getLinks(t.id),s=n(i,t.id);r.hasOwnProperty(s)?r[s].push(t.id):r[s]=[t.id]});for(var s in r)if(r.hasOwnProperty(s)){var o=r[s];if(!o)continue;for(var u=0;u<o.length;++u)i.unshift({key:o[u],value:parseInt(s,10)})}return i}}},Viva.Graph._community={},Viva.Graph._community.slpaAlgorithm=function(e,t,n){t=t||100,n=n||.3;var r=Viva.random(1331782216905),i=Viva.random("Greeting goes to you, ","dear reader"),s=function(e,n){var r=[];return e.forEachUniqueWord(function(e,i){if(!(i>n))return!0;r.push({name:e,probability:i/t})}),r},o=function(e){var t=[];return e.forEachNode(function(e){var n=Viva.Graph._community.occuranceMap(r);n.add(e.id),e.slpa={memory:n},t.push(e.id)}),t},u=function(e,n){var s=Viva.randomIterator(n,i),o=function(t){var n=e.getNode(t),i=Viva.Graph._community.occuranceMap(r);e.forEachLinkedNode(t,function(e){var t=e.slpa.memory.getRandomWord();i.add(t)});var s=i.getMostPopularFair();n.slpa.memory.add(s)};for(var u=0;u<t-1;++u)s.forEach(o)},a=function(e){var r={};return e.forEachNode(function(e){var i=s(e.slpa.memory,n*t);for(var o=0;o<i.length;++o){var u=i[o].name;r.hasOwnProperty(u)?r[u].push(e.id):r[u]=[e.id]}e.communities=i,e.slpa=null,delete e.slpa}),r};return{run:function(){var t=o(e);return u(e,t),a(e)}}},Viva.Graph._community.occuranceMap=function(e){e=e||Viva.random();var t={},n=[],r=!1,i=[],s=function(){i.length=0;for(var e in t)t.hasOwnProperty(e)&&i.push(e);i.sort(function(e,n){var r=t[n]-t[e];return r?r:e<n?-1:e>n?1:0})},o=function(){r&&(s(),r=!1)};return{add:function(e){e=String(e),t.hasOwnProperty(e)?t[e]+=1:t[e]=1,n.push(e),r=!0},getWordCount:function(e){return t[e]||0},getMostPopularFair:function(){if(n.length===1)return n[0];o();var r=0;for(var s=1;s<i.length;++s){if(t[i[s-1]]!==t[i[s]])break;r+=1}return r+=1,i[e.next(r)]},getRandomWord:function(){if(n.length===0)throw"The occurance map is empty. Cannot get empty word";return n[e.next(n.length)]},forEachUniqueWord:function(e){if(typeof e!="function")throw"Function callback is expected to enumerate all words";o();for(var n=0;n<i.length;++n){var r=i[n],s=t[r],u=e(r,s);if(u)break}}}},Viva.Graph.community=function(){return{slpa:function(e,t,n){var r=Viva.Graph._community.slpaAlgorithm(e,t,n);return r.run()}}},Viva.Graph.Physics=Viva.Graph.Physics||{},Viva.Graph.Physics.Vector=function(e,t){this.x=e||0,this.y=t||0},Viva.Graph.Physics.Vector.prototype={multiply:function(e){return new Viva.Graph.Physics.Vector(this.x*e,this.y*e)}},Viva.Graph.Physics.Point=function(e,t){this.x=e||0,this.y=t||0},Viva.Graph.Physics.Point.prototype={add:function(e){return new Viva.Graph.Physics.Point(this.x+e.x,this.y+e.y)}},Viva.Graph.Physics.Body=function(){this.mass=1,this.force=new Viva.Graph.Physics.Vector,this.velocity=new Viva.Graph.Physics.Vector,this.location=new Viva.Graph.Physics.Point,this.prevLocation=new Viva.Graph.Physics.Point},Viva.Graph.Physics.Body.prototype={loc:function(e){return e?(this.location.x=e.x,this.location.y=e.y,this):this.location},vel:function(e){return e?(this.velocity.x=e.x,this.velocity.y=e.y,this):this.velocity}},Viva.Graph.Physics.Spring=function(e,t,n,r,i){this.body1=e,this.body2=t,this.length=n,this.coeff=r,this.weight=i},Viva.Graph.Physics.QuadTreeNode=function(){this.centerOfMass=new Viva.Graph.Physics.Point,this.children=[],this.body=null,this.hasChildren=!1,this.x1=0,this.y1=0,this.x2=0,this.y2=0},Viva.Graph.Physics=Viva.Graph.Physics||{},Viva.Graph.Physics.eulerIntegrator=function(){return{integrate:function(e,t){var n=e.speedLimit,r=0,i=0;for(var s=0,o=e.bodies.length;s<o;++s){var u=e.bodies[s],a=t/u.mass;u.velocity.x+=a*u.force.x,u.velocity.y+=a*u.force.y;var f=u.velocity.x,l=u.velocity.y,c=Math.sqrt(f*f+l*l);c>n&&(u.velocity.x=n*f/c,u.velocity.y=n*l/c),r=t*u.velocity.x,i=t*u.velocity.y,u.location.x+=r,u.location.y+=i}return r*r+i*i}}},Viva.Graph.Physics.nbodyForce=function(e){e=e||{};var t=typeof e.gravity=="number"?e.gravity:-1,n=[],r=e.theta||.8,i=Viva.random("5f4dcc3b5aa765d61d8327deb882cf99",75,20,63,108,65,76,65,72),s=function(){this.body=null,this.quads=[],this.mass=0,this.massX=0,this.massY=0,this.left=0,this.top=0,this.bottom=0,this.right=0,this.isInternal=!1},o=[],u=0,a=function(){var e;return o[u]?(e=o[u],e.quads[0]=null,e.quads[1]=null,e.quads[2]=null,e.quads[3]=null,e.body=null,e.mass=e.massX=e.massY=0,e.left=e.right=e.top=e.bottom=0,e.isInternal=!1):(e=new s,o[u]=e),++u,e},f=a(),l=function(e,t){var n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);return n<.01&&r<.01},c=function(e){var t=[{node:f,body:e}];while(t.length){var n=t.shift(),r=n.node,s=n.body;if(r.isInternal){var o=s.location.x,u=s.location.y;r.mass=r.mass+s.mass,r.massX=r.massX+s.mass*o,r.massY=r.massY+s.mass*u;var c=0,h=r.left,p=(r.right+h)/2,d=r.top,v=(r.bottom+d)/2;if(o>p){c+=1;var m=h;h=p,p+=p-m}if(u>v){c+=2;var g=d;d=v,v+=v-g}var y=r.quads[c];y||(y=a(),y.left=h,y.top=d,y.right=p,y.bottom=v,r.quads[c]=y),t.unshift({node:y,body:s})}else if(r.body){var b=r.body;r.body=null,r.isInternal=!0;if(l(b.location,s.location)){var w,E;do{var S=i.nextDouble()*2*Math.PI,x=(r.right-r.left)*.006*Math.cos(S),T=(r.bottom-r.top)*.006*Math.sin(S);w=b.location.x+x,E=b.location.y+T}while(w<r.left||w>r.right||E<r.top||E>r.bottom);b.location.x=w,b.location.y=E}t.unshift({node:r,body:b}),t.unshift({node:r,body:s})}else r.body=s}},h=function(e){var s=n,o,u,a,l,c=1,h=0,p=1;s[0]=f;while(c){var d=s[h],v=d.body;c-=1,h+=1,v&&v!==e?(u=v.location.x-e.location.x,a=v.location.y-e.location.y,l=Math.sqrt(u*u+a*a),l===0&&(u=(i.nextDouble()-.5)/50,a=(i.nextDouble()-.5)/50,l=Math.sqrt(u*u+a*a)),o=t*v.mass*e.mass/(l*l*l),e.force.x=e.force.x+o*u,e.force.y=e.force.y+o*a):(u=d.massX/d.mass-e.location.x,a=d.massY/d.mass-e.location.y,l=Math.sqrt(u*u+a*a),l===0&&(u=(i.nextDouble()-.5)/50,a=(i.nextDouble()-.5)/50,l=Math.sqrt(u*u+a*a)),(d.right-d.left)/l<r?(o=t*d.mass*e.mass/(l*l*l),e.force.x=e.force.x+o*u,e.force.y=e.force.y+o*a):(d.quads[0]&&(s[p]=d.quads[0],c+=1,p+=1),d.quads[1]&&(s[p]=d.quads[1],c+=1,p+=1),d.quads[2]&&(s[p]=d.quads[2],c+=1,p+=1),d.quads[3]&&(s[p]=d.quads[3],c+=1,p+=1)))}},p=function(e){var t=Number.MAX_VALUE,n=Number.MAX_VALUE,r=Number.MIN_VALUE,i=Number.MIN_VALUE,s,o=e.bodies,l=o.length;s=l;while(s--){var h=o[s].location.x,p=o[s].location.y;h<t&&(t=h),h>r&&(r=h),p<n&&(n=p),p>i&&(i=p)}var d=r-t,v=i-n;d>v?i=n+d:r=t+v,u=0,f=a(),f.left=t,f.right=r,f.top=n,f.bottom=i,s=l;while(s--)c(o[s],f)};return{insert:c,init:p,update:h,options:function(e){return e?(typeof e.gravity=="number"&&(t=e.gravity),typeof e.theta=="number"&&(r=e.theta),this):{gravity:t,theta:r}}}},Viva.Graph.Physics.nbodyForceBrute=function(e){e=e||{};var t=typeof e.gravity=="number"?e.gravity:-1,n=[],r=Viva.random("don't use this"),i=function(e){e.force.x=0,e.force.y=0;for(var i=0;i<n.length;++i){var s=n[i];if(s!==e){var o=s.location.x-e.location.x,u=s.location.y-e.location.y,a=Math.sqrt(o*o+u*u);a===0&&(o=(r.nextDouble()-.5)/50,u=(r.nextDouble()-.5)/50,a=Math.sqrt(o*o+u*u));var f=t*s.mass*e.mass/(a*a*a);e.force.x=e.force.x+f*o,e.force.y=e.force.y+f*u}}};return{insert:function(){},init:function(e){n=e.bodies},update:i,options:function(e){return e?(typeof e.gravity=="number"&&(t=e.gravity),this):{gravity:t}}}},Viva.Graph.Physics.dragForce=function(e){e=e||{};var t={coeff:e.coeff||.01};return{init:function(e){},update:function(e){e.force.x-=t.coeff*e.velocity.x,e.force.y-=t.coeff*e.velocity.y},options:function(e){return e?(typeof e.coeff=="number"&&(t.coeff=e.coeff),this):t}}},Viva.Graph.Physics.springForce=function(e){e=e||{};var t={length:e.length||50,coeff:typeof e.coeff=="number"?e.coeff:22e-5},n=Viva.random("Random number 4.","Chosen by fair dice roll");return{init:function(e){},update:function(e){var r=e.body1,i=e.body2,s=e.length<0?t.length:e.length,o=i.location.x-r.location.x,u=i.location.y-r.location.y,a=Math.sqrt(o*o+u*u);a===0&&(o=(n.nextDouble()-.5)/50,u=(n.nextDouble()-.5)/50,a=Math.sqrt(o*o+u*u));var f=a-s,l=(!e.coeff||e.coeff<0?t.coeff:e.coeff)*f/a*e.weight;r.force.x+=l*o,r.force.y+=l*u,i.force.x+=-l*o,i.force.y+=-l*u},options:function(e){return e?(typeof e.length=="number"&&(t.length=e.length),typeof e.coeff=="number"&&(t.coeff=e.coeff),this):t}}},Viva.Graph.Physics=Viva.Graph.Physics||{},Viva.Graph.Physics.forceSimulator=function(e){var t=e||Viva.Graph.Physics.rungeKuttaIntegrator(),n=[],r=[],i=[],s=[];return{speedLimit:1,bodies:n,accumulate:function(){var e,t,o;e=i.length;while(e--)i[e].init(this);e=s.length;while(e--)s[e].init(this);e=n.length;while(e--){o=n[e],o.force.x=0,o.force.y=0;for(t=0;t<i.length;t++)i[t].update(o)}for(e=0;e<r.length;++e)for(t=0;t<s.length;t++)s[t].update(r[e])},run:function(e){return this.accumulate(),t.integrate(this,e)},addBody:function(e){if(!e)throw{message:"Cannot add null body to force simulator"};return n.push(e),e},removeBody:function(e){if(!e)return!1;var t=Viva.Graph.Utils.indexOfElementInArray(e,n);return t<0?!1:n.splice(t,1)},addSpring:function(e,t,n,i,s){if(!e||!t)throw{message:"Cannot add null spring to force simulator"};if(typeof n!="number")throw{message:"Spring length should be a number"};s=typeof s=="number"?s:1;var o=new Viva.Graph.Physics.Spring(e,t,n,i>=0?i:-1,s);return r.push(o),o},removeSpring:function(e){if(!e)return!1;var t=Viva.Graph.Utils.indexOfElementInArray(e,r);return t<0?!1:r.splice(t,1)},addBodyForce:function(e){if(!e)throw{message:"Cannot add mighty (unknown) force to the simulator"};i.push(e)},addSpringForce:function(e){if(!e)throw{message:"Cannot add unknown force to the simulator"};s.push(e)}}},Viva.Graph.Layout=Viva.Graph.Layout||{},Viva.Graph.Layout.forceDirected=function(e,t){var n=.001;if(!e)throw{message:"Graph structure cannot be undefined"};t=t||{};var r={springLength:typeof t.springLength=="number"?t.springLength:80,springCoeff:typeof t.springCoeff=="number"?t.springCoeff:2e-4,gravity:typeof t.gravity=="number"?t.gravity:-1.2,theta:typeof t.theta=="number"?t.theta:.8,dragCoeff:typeof t.dragCoeff=="number"?t.dragCoeff:.02},i=Viva.Graph.Physics.forceSimulator(Viva.Graph.Physics.eulerIntegrator()),s=Viva.Graph.Physics.nbodyForce({gravity:r.gravity,theta:r.theta}),o=Viva.Graph.Physics.springForce({length:r.springLength,coeff:r.springCoeff}),u=Viva.Graph.Physics.dragForce({coeff:r.dragCoeff}),a=!0,f=new Viva.Graph.Rect,l=Viva.random("ted.com",103,114,101,97,116),c=function(t){var n=(f.x1+f.x2)/2,i=(f.y1+f.y2)/2,s=r.springLength;if(t.links&&t.links.length>0){var o=t.links[0],u=o.fromId!=t.id?e.getNode(o.fromId):e.getNode(o.toId);u.position&&(n=u.position.x,i=u.position.y)}return{x:n+l.next(s)-s/2,y:i+l.next(s)-s/2}},h=function(t){var n=t.force_directed_body;n.mass=1+e.getLinks(t.id).length/3},p=function(e){var t=e.force_directed_body;t||(e.position=e.position||c(e),t=new Viva.Graph.Physics.Body,e.force_directed_body=t,h(e),t.loc(e.position),i.addBody(t))},d=function(e){var t=e.force_directed_body;t&&(e.force_directed_body=null,delete e.force_directed_body,i.removeBody(t))},v=function(t){var n=e.getNode(t.fromId),r=e.getNode(t.toId);h(n),h(r),t.force_directed_spring=i.addSpring(n.force_directed_body,r.force_directed_body,-1,t.weight)},m=function(t){var n=t.force_directed_spring;if(n){var r=e.getNode(t.fromId),s=e.getNode(t.toId);r&&h(r),s&&h(s),t.force_directed_spring=null,delete t.force_directed_spring,i.removeSpring(n)}},g=function(){e.forEachNode(p),e.forEachLink(v)},y=function(e){return e?e.isPinned||e.data&&e.data.isPinned:!0},b=function(){var t=Number.MAX_VALUE,n=Number.MAX_VALUE,r=Number.MIN_VALUE,i=Number.MIN_VALUE;if(e.getNodesCount()===0)return;e.forEachNode(function(e){var s=e.force_directed_body;if(!s)return;y(e)&&s.loc(e.position),e.position.x=s.location.x,e.position.y=s.location.y,e.position.x<t&&(t=e.position.x),e.position.x>r&&(r=e.position.x),e.position.y<n&&(n=e.position.y),e.position.y>i&&(i=e.position.y)}),f.x1=t,f.x2=r,f.y1=n,f.y2=i};return i.addSpringForce(o),i.addBodyForce(s),i.addBodyForce(u),{run:function(e){e=e||50;for(var t=0;t<e;++t)this.step()},step:function(){a&&(g(),a=!1);var e=i.run(20);return b(),e<n},getGraphRect:function(){return f},addNode:function(e){p(e)},removeNode:function(e){d(e)},addLink:function(e){v(e)},removeLink:function(e){m(e)},springLength:function(e){return arguments.length===1?(o.options({length:e}),this):o.options().length},springCoeff:function(e){return arguments.length===1?(o.options({coeff:e}),this):o.options().coeff},gravity:function(e){return arguments.length===1?(s.options({gravity:e}),this):s.options().gravity},theta:function(e){return arguments.length===1?(s.options({theta:e}),this):s.options().theta},drag:function(e){return arguments.length===1?(u.options({coeff:e}),this):u.options().coeff}}},Viva.Graph.Layout=Viva.Graph.Layout||{},Viva.Graph.Layout.constant=function(e,t){t=t||{};var n=t.seed||"Deterministic randomness made me do this",r=typeof t.maxX=="number"?t.maxX:1024,i=typeof t.maxY=="number"?t.maxY:1024,s=Viva.random(n),o=new Viva.Graph.Rect,u=function(e){return new Viva.Graph.Point2d(s.next(r),s.next(i))},a=function(){var t=Number.MAX_VALUE,n=Number.MAX_VALUE,r=Number.MIN_VALUE,i=Number.MIN_VALUE;if(e.getNodesCount()===0)return;e.forEachNode(function(e){e.hasOwnProperty("position")||(e.position=u(e)),e.position.x<t&&(t=e.position.x),e.position.x>r&&(r=e.position.x),e.position.y<n&&(n=e.position.y),e.position.y>i&&(i=e.position.y)}),o.x1=t,o.x2=r,o.y1=n,o.y2=i};return{run:function(e){this.step()},step:function(){return a(),!1},getGraphRect:function(){return o},addNode:function(e){},removeNode:function(e){},addLink:function(e){},removeLink:function(e){},placeNode:function(e){return typeof e=="function"?(u=e,a(),this):u(e)}}},Viva.Graph.View=Viva.Graph.View||{},Viva.Graph.View.cssGraphics=function(){var e,t="OLD_IE",n,r,i=1,s=1,o=function(){var e=Viva.BrowserInfo.browser,n,r;switch(e){case"mozilla":n="Moz";break;case"webkit":n="webkit";break;case"opera":n="O";break;case"msie":r=Viva.BrowserInfo.version.split(".")[0];if(!(r>8))return t;n="ms"}return n?n+"Transform":null}(),u=function(){return o===t?function(e,t,n,r){var i=Math.cos(r),s=Math.sin(r);r<0&&(r=2*Math.PI+r),r<Math.PI/2?(e.style.left=t+"px",e.style.top=n+"px"):r<Math.PI?(e.style.left=t-e.clientWidth*Math.cos(Math.PI-r),e.style.top=n):r<Math.PI+Math.PI/2?(e.style.left=t-e.clientWidth*Math.cos(Math.PI-r),e.style.top=n+e.clientWidth*Math.sin(Math.PI-r)):(e.style.left=t,e.style.top=n+e.clientWidth*Math.sin(Math.PI-r)),e.style.filter="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand',M11="+i+", M12="+ -s+","+"M21="+s+", M22="+i+");"}:o?function(e,t,n,r){e.style.left=t+"px",e.style.top=n+"px",e.style[o]="rotate("+r+"rad)",e.style[o+"Origin"]="left"}:function(e,t,n,r){}}(),a=function(e){var t=document.createElement("div");return t.setAttribute("class","node"),t},f=function(e,t){e.style.left=t.x-5+"px",e.style.top=t.y-5+"px"},l=function(e,t,n){var r=t.x-n.x,i=t.y-n.y,s=Math.sqrt(r*r+i*i);e.style.height="1px",e.style.width=s+"px",u(e,n.x,n.y,Math.atan2(i,r))},c=function(e){var t=document.createElement("div");return t.setAttribute("class","link"),t},h=function(){if(e&&o&&o!==t){var u="matrix("+i+", 0, 0,"+s+","+n+","+r+")";e.style[o]=u}};return{node:function(e){return e&&typeof e!="function"?a(e):(a=e,this)},link:function(e){return e&&typeof e!="function"?c(e):(c=e,this)},inputManager:Viva.Input.domInputManager,graphCenterChanged:function(e,t){n=e,r=t,h()},translateRel:function(e,t){n+=e,r+=t,h()},scale:function(e,t){return 1},resetScale:function(){return this},beginRender:function(){},endRender:function(){},placeNode:function(e){return f=e,this},placeLink:function(e){return l=e,this},init:function(t){e=t,h()},initLink:function(t){e.childElementCount>0?e.insertBefore(t,e.firstChild):e.appendChild(t)},releaseLink:function(t){e.removeChild(t)},initNode:function(t){e.appendChild(t)},releaseNode:function(t){e.removeChild(t)},updateNodePosition:function(e,t){f(e,t)},updateLinkPosition:function(e,t,n){l(e,t,n)}}},Viva.Graph.svg=function(e){var t="http://www.w3.org/2000/svg",n="http://www.w3.org/1999/xlink",r=e;return typeof e=="string"&&(r=document.createElementNS(t,e)),r.vivagraph_augmented?r:(r.vivagraph_augmented=!0,r.attr=function(e,t){return arguments.length===2?(t!==null?r.setAttributeNS(null,e,t):r.removeAttributeNS(null,e),r):r.getAttributeNS(null,e)},r.append=function(e){var t=Viva.Graph.svg(e);return r.appendChild(t),t},r.text=function(e){return typeof e=="undefined"?r.textContent:(r.textContent=e,r)},r.link=function(e){return arguments.length===0?r.getAttributeNS(n,"xlink:href"):(r.setAttributeNS(n,"xlink:href",e),r)},r.children=function(e){var t=[],n=r.childNodes.length;if(e===undefined&&r.hasChildNodes())for(var i=0;i<n;i++)t.push(Viva.Graph.svg(r.childNodes[i]));else if(typeof e=="string"){var s=e[0]===".",o=e[0]==="#",u=!s&&!o;for(var i=0;i<n;i++){var a=r.childNodes[i];if(a.nodeType!==1)continue;var f=a.attr("class"),l=a.attr("id"),c=a.nodeName;if(s&&f){f=f.replace(/\s+/g," ").split(" ");for(var h=0;h<f.length;h++)if(s&&f[h]===e.substr(1)){t.push(Viva.Graph.svg(a));break}}else{if(o&&l===e.substr(1)){t.push(Viva.Graph.svg(a));break}u&&c===e&&t.push(Viva.Graph.svg(a))}t=t.concat(Viva.Graph.svg(a).children(e))}if(o&&t.length===1)return t[0]}return t},r)},Viva.Graph.View=Viva.Graph.View||{},Viva.Graph.View.svgGraphics=function(){var e,t,n,r,i=1,s=function(e){return Viva.Graph.svg("rect").attr("width",10).attr("height",10).attr("fill","#00a2e8")},o=function(e,t){e.attr("x",t.x-5).attr("y",t.y-5)},u=function(e){return Viva.Graph.svg("line").attr("stroke","#999")},a=function(e,t,n){e.attr("x1",t.x).attr("y1",t.y).attr("x2",n.x).attr("y2",n.y)},f=function(e){e.fire("rescaled")},l=function(){if(e){var t="matrix("+i+", 0, 0,"+i+","+n+","+r+")";e.attr("transform",t)}},c={node:function(e){return e&&typeof e!="function"?s(e):(s=e,this)},link:function(e){return e&&typeof e!="function"?u(e):(u=e,this)},placeNode:function(e){return o=e,this},placeLink:function(e){return a=e,this},beginRender:function(){},endRender:function(){},graphCenterChanged:function(e,t){n=e,r=t,l()},inputManager:Viva.Input.domInputManager,translateRel:function(n,r){var i=t.createSVGPoint(),s=e.getCTM(),o=t.createSVGPoint().matrixTransform(s.inverse());i.x=n,i.y=r,i=i.matrixTransform(s.inverse()),i.x=(i.x-o.x)*s.a,i.y=(i.y-o.y)*s.d,s.e+=i.x,s.f+=i.y;var u="matrix("+s.a+", 0, 0,"+s.d+","+s.e+","+s.f+")";e.attr("transform",u)},scale:function(s,o){var u=t.createSVGPoint();u.x=o.x,u.y=o.y,u=u.matrixTransform(e.getCTM().inverse());var a=t.createSVGMatrix().translate(u.x,u.y).scale(s).translate(-u.x,-u.y),l=e.getCTM().multiply(a);i=l.a,n=l.e,r=l.f;var c="matrix("+l.a+", 0, 0,"+l.d+","+l.e+","+l.f+")";return e.attr("transform",c),f(this),i},resetScale:function(){i=1;var t="matrix(1, 0, 0, 1, 0, 0)";return e.attr("transform",t),f(this),this},init:function(n){t=Viva.Graph.svg("svg"),e=Viva.Graph.svg("g").attr("buffered-rendering","dynamic"),t.appendChild(e),n.appendChild(t),l()},initLink:function(t){if(!t)return;e.childElementCount>0?e.insertBefore(t,e.firstChild):e.appendChild(t)},releaseLink:function(t){e.removeChild(t)},initNode:function(t){e.appendChild(t)},releaseNode:function(t){e.removeChild(t)},updateNodePosition:function(e,t){o(e,t)},updateLinkPosition:function(e,t,n){a(e,t,n)},getSvgRoot:function(){return t}};return Viva.Graph.Utils.events(c).extend(),c},Viva.Graph.View.svgNodeFactory=function(e){var t="orange",n="#999",r=Viva.Graph.geom(),i=function(e,t){e.size={w:10,h:10},e.append("rect").attr("width",e.size.w).attr("height",e.size.h).attr("stroke","orange").attr("fill","orange")},s=function(e){return e.size};return{node:function(e){var t=Viva.Graph.svg("g");return i(t,e),t.nodeId=e.id,t},link:function(t){var r=e.getNode(t.fromId),i=r&&r.ui;if(i&&!i.linksContainer){var s=Viva.Graph.svg("path").attr("stroke",n);return i.linksContainer=s,s}return null},customContent:function(e,t){if(typeof e!="function"||typeof t!="function")throw"Two functions expected: contentCreator(nodeUI, node) and size(nodeUI)";i=e,s=t},placeNode:function(t,n){var i="",o=s(t);e.forEachLinkedNode(t.nodeId,function(e,u){if(!e.position||!e.ui)return;if(e.ui===t)return;if(u.fromId!==t.nodeId)return;var a=s(e.ui),f=e.position,l=r.intersectRect(n.x-o.w/2,n.y-o.h/2,n.x+o.w/2,n.y+o.h/2,n.x,n.y,f.x,f.y)||n,c=r.intersectRect(f.x-a.w/2,f.y-a.h/2,f.x+a.w/2,f.y+a.h/2,f.x,f.y,n.x,n.y)||f;i+="M"+Math.round(l.x)+" "+Math.round(l.y)+"L"+Math.round(c.x)+" "+Math.round(c.y)}),t.attr("transform","translate("+(n.x-o.w/2)+", "+(n.y-o.h/2)+")"),i!==""&&t.linksContainer&&t.linksContainer.attr("d",i)}}},Viva.Graph.webgl=function(e){var t=function(t,n){var r=e.createShader(n);e.shaderSource(r,t),e.compileShader(r);if(!e.getShaderParameter(r,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(r);throw alert(i),i}return r};return{createProgram:function(n,r){var i=e.createProgram(),s=t(n,e.VERTEX_SHADER),o=t(r,e.FRAGMENT_SHADER);e.attachShader(i,s),e.attachShader(i,o),e.linkProgram(i);if(!e.getProgramParameter(i,e.LINK_STATUS)){var u=e.getShaderInfoLog(i);throw alert(u),u}return i},extendArray:function(e,t,n){if((t+1)*n>e.length){var r=new Float32Array(e.length*n*2);return r.set(e),r}return e},copyArrayPart:function(e,t,n,r){for(var i=0;i<r;++i)e[t+i]=e[n+i]},swapArrayPart:function(e,t,n,r){for(var i=0;i<r;++i){var s=e[t+i];e[t+i]=e[n+i],e[n+i]=s}},getLocations:function(t,n){var r={};for(var i=0;i<n.length;++i){var s=n[i],o=-1;if(s.indexOf("a_")===0){o=e.getAttribLocation(t,s);if(o===-1)throw"Program doesn't have required attribute: "+s;r[s.slice(2)]=o}else{if(s.indexOf("u_")!==0)throw"Couldn't figure out your intent. All uniforms should start with 'u_' prefix, and attributes with 'a_'";o=e.getUniformLocation(t,s);if(o===null)throw"Program doesn't have required uniform: "+s;r[s.slice(2)]=o}}return r},context:e}},Viva.Graph.View.WebglUtils=function(){},Viva.Graph.View.WebglUtils.prototype.parseColor=function(e){var t=10414335;if(typeof e=="string"&&e){e.length===4&&(e=e.replace(/([^#])/g,"$1$1"));if(e.length===9)t=parseInt(e.substr(1),16);else{if(e.length!==7)throw'Color expected in hex format with preceding "#". E.g. #00ff00. Got value: '+e;t=parseInt(e.substr(1),16)<<8|255}}else typeof e=="number"&&(t=e);return t},Viva.Graph.View._webglUtil=new Viva.Graph.View.WebglUtils,Viva.Graph.View.webglLine=function(e){return{color:Viva.Graph.View._webglUtil.parseColor(e)}},Viva.Graph.View.webglSquare=function(e,t){return{size:typeof e=="number"?e:10,color:Viva.Graph.View._webglUtil.parseColor(t)}},Viva.Graph.View.webglImage=function(e,t){return{_texture:0,_offset:0,size:typeof e=="number"?e:32,src:t}},Viva.Graph.View.webglNodeProgram=function(){var e=4,t=3*Float32Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT,n=["precision mediump float;","varying vec4 color;","void main(void) {","   gl_FragColor = color;","}"].join("\n"),r=["attribute vec3 a_vertexPos;","attribute vec4 a_color;","uniform vec2 u_screenSize;","uniform mat4 u_transform;","varying vec4 color;","void main(void) {","   gl_Position = u_transform * vec4(a_vertexPos.xy/u_screenSize, 0, 1);","   gl_PointSize = a_vertexPos.z * u_transform[0][0];","   color = a_color.abgr;","}"].join("\n"),i,s,o,u,a,f=new ArrayBuffer(16*t),l=new Float32Array(f),c=new Uint32Array(f),h=0,p,d,v,m,g=function(){if((h+1)*t>=f.byteLength){var e=new ArrayBuffer(f.byteLength*2),n=new Float32Array(e),r=new Uint32Array(e);r.set(c),l=n,c=r,f=e}};return{load:function(e){s=e,a=Viva.Graph.webgl(e),i=a.createProgram(r,n),s.useProgram(i),u=a.getLocations(i,["a_vertexPos","a_color","u_screenSize","u_transform"]),s.enableVertexAttribArray(u.vertexPos),s.enableVertexAttribArray(u.color),o=s.createBuffer()},position:function(t,n){var r=t.id,i=r*e;l[r*e]=n.x,l[r*e+1]=n.y,l[r*e+2]=t.size,c[r*e+3]=t.color},updateTransform:function(e){m=!0,v=e},updateSize:function(e,t){p=e,d=t,m=!0},createNode:function(e){g(),h+=1},removeNode:function(t){h>0&&(h-=1),t.id<h&&h>0&&a.copyArrayPart(c,t.id*e,h*e,e)},replaceProperties:function(e,t){},render:function(){s.useProgram(i),s.bindBuffer(s.ARRAY_BUFFER,o),s.bufferData(s.ARRAY_BUFFER,f,s.DYNAMIC_DRAW),m&&(m=!1,s.uniformMatrix4fv(u.transform,!1,v),s.uniform2f(u.screenSize,p,d)),s.vertexAttribPointer(u.vertexPos,3,s.FLOAT,!1,e*Float32Array.BYTES_PER_ELEMENT,0),s.vertexAttribPointer(u.color,4,s.UNSIGNED_BYTE,!0,e*Float32Array.BYTES_PER_ELEMENT,12),s.drawArrays(s.POINTS,0,h)}}},Viva.Graph.View.webglLinkProgram=function(){var e=6,t=2*(2*Float32Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT),n=["precision mediump float;","varying vec4 color;","void main(void) {","   gl_FragColor = color;","}"].join("\n"),r=["attribute vec2 a_vertexPos;","attribute vec4 a_color;","uniform vec2 u_screenSize;","uniform mat4 u_transform;","varying vec4 color;","void main(void) {","   gl_Position = u_transform * vec4(a_vertexPos/u_screenSize, 0.0, 1.0);","   color = a_color.abgr;","}"].join("\n"),i,s,o,u,a,f=0,l,c=new ArrayBuffer(16*t),h=new Float32Array(c),p=new Uint32Array(c),d,v,m,g,y=function(){if((f+1)*t>c.byteLength){var e=new ArrayBuffer(c.byteLength*2),n=new Float32Array(e),r=new Uint32Array(e);r.set(p),h=n,p=r,c=e}};return{load:function(e){s=e,u=Viva.Graph.webgl(e),i=u.createProgram(r,n),s.useProgram(i),a=u.getLocations(i,["a_vertexPos","a_color","u_screenSize","u_transform"]),s.enableVertexAttribArray(a.vertexPos),s.enableVertexAttribArray(a.color),o=s.createBuffer()},position:function(t,n,r){var i=t.id,s=i*e;h[s]=n.x,h[s+1]=n.y,p[s+2]=t.color,h[s+3]=r.x,h[s+4]=r.y,p[s+5]=t.color},createLink:function(e){y(),f+=1,l=e.id},removeLink:function(t){f>0&&(f-=1),t.id<f&&f>0&&u.copyArrayPart(p,t.id*e,f*e,e)},updateTransform:function(e){g=!0,m=e},updateSize:function(e,t){d=e,v=t,g=!0},render:function(){s.useProgram(i),s.bindBuffer(s.ARRAY_BUFFER,o),s.bufferData(s.ARRAY_BUFFER,c,s.DYNAMIC_DRAW),g&&(g=!1,s.uniformMatrix4fv(a.transform,!1,m),s.uniform2f(a.screenSize,d,v)),s.vertexAttribPointer(a.vertexPos,2,s.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),s.vertexAttribPointer(a.color,4,s.UNSIGNED_BYTE,!0,3*Float32Array.BYTES_PER_ELEMENT,8),s.drawArrays(s.LINES,0,f*2),l=f-1},bringToFront:function(t){l>t.id&&u.swapArrayPart(h,t.id*e,l*e,e),l>0&&(l-=1)},getFrontLinkId:function(){return l}}},Viva.Graph.View.Texture=function(e){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.isDirty=!1,this.canvas.width=this.canvas.height=e},Viva.Graph.View.webglAtlas=function(e){var t=Math.sqrt(e||1024)<<0,n=t,r=1,i={},s,o=0,u=[],a=[],f,l=function(e){return e<<=0,e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e+1},c=function(e){return(e&e-1)===0},h=function(){var e=new Viva.Graph.View.Texture(t*n);u.push(e)},p=function(n){var r=n/e<<0,i=n%e,s=i/t<<0,o=i%t;return{textureNumber:r,row:s,col:o}},d=function(){f.isDirty=!0,o=0,s=null},v=function(){s&&(clearTimeout(s),o+=1,s=null),o>10?d():s=setTimeout(d,400)},m=function(e,t){var r=u[e.textureNumber].canvas,i=u[t.textureNumber].ctx,s=t.col*n,o=t.row*n;i.drawImage(r,e.col*n,e.row*n,n,n,s,o,n,n),u[e.textureNumber].isDirty=!0,u[t.textureNumber].isDirty=!0},g=function(e,t,r){var s=p(e),o={offset:e};s.textureNumber>=u.length&&h();var f=u[s.textureNumber];f.ctx.drawImage(t,s.col*n,s.row*n,n,n),a[e]=t.src,i[t.src]=o,f.isDirty=!0,r(o)};if(!c(e))throw"Tiles per texture should be power of two.";return f={isDirty:!1,clearDirty:function(){this.isDirty=!1;for(var e=0;e<u.length;++e)u[e].isDirty=!1},remove:function(e){var t=i[e];if(!t)return!1;delete i[e],r-=1;if(r===t.offset)return!0;var n=p(t.offset),s=p(r);m(s,n);var o=i[a[r]];return o.offset=t.offset,a[t.offset]=a[r],v(),!0},getTextures:function(){return u},getCoordinates:function(e){return i[e]},load:function(e,t){if(i.hasOwnProperty(e))t(i[e]);else{var n=new Image,s=r,o=this;r+=1,n.crossOrigin="anonymous",n.onload=function(){v(),g(s,n,t)},n.src=e}}},f},Viva.Graph.View.webglImageNodeProgram=function(){var e=18,t=["precision mediump float;","varying vec4 color;","varying vec3 vTextureCoord;","uniform sampler2D u_sampler0;","uniform sampler2D u_sampler1;","uniform sampler2D u_sampler2;","uniform sampler2D u_sampler3;","void main(void) {","   if (vTextureCoord.z == 0.) {","     gl_FragColor = texture2D(u_sampler0, vTextureCoord.xy);","   } else if (vTextureCoord.z == 1.) {","     gl_FragColor = texture2D(u_sampler1, vTextureCoord.xy);","   } else if (vTextureCoord.z == 2.) {","     gl_FragColor = texture2D(u_sampler2, vTextureCoord.xy);","   } else if (vTextureCoord.z == 3.) {","     gl_FragColor = texture2D(u_sampler3, vTextureCoord.xy);","   } else { gl_FragColor = vec4(0, 1, 0, 1); }","}"].join("\n"),n=["attribute vec2 a_vertexPos;","attribute float a_customAttributes;","uniform vec2 u_screenSize;","uniform mat4 u_transform;","uniform float u_tilesPerTexture;","varying vec3 vTextureCoord;","void main(void) {","   gl_Position = u_transform * vec4(a_vertexPos/u_screenSize, 0, 1);","float corner = mod(a_customAttributes, 4.);","float tileIndex = mod(floor(a_customAttributes / 4.), u_tilesPerTexture);","float tilesPerRow = sqrt(u_tilesPerTexture);","float tileSize = 1./tilesPerRow;","float tileColumn = mod(tileIndex, tilesPerRow);","float tileRow = floor(tileIndex/tilesPerRow);","if(corner == 0.0) {","  vTextureCoord.xy = vec2(0, 1);","} else if(corner == 1.0) {","  vTextureCoord.xy = vec2(1, 1);","} else if(corner == 2.0) {","  vTextureCoord.xy = vec2(0, 0);","} else {","  vTextureCoord.xy = vec2(1, 0);","}","vTextureCoord *= tileSize;","vTextureCoord.x += tileColumn * tileSize;","vTextureCoord.y += tileRow * tileSize;","vTextureCoord.z = floor(floor(a_customAttributes / 4.)/u_tilesPerTexture);","}"].join("\n"),r=1024,i,s,o,u,a,f,l,c=0,h,p=new Float32Array(64),d,v,m,g,y=function(e,t){e.nativeObject&&u.deleteTexture(e.nativeObject);var n=u.createTexture();u.activeTexture(u["TEXTURE"+t]),u.bindTexture(u.TEXTURE_2D,n),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,e.canvas),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR_MIPMAP_NEAREST),u.generateMipmap(u.TEXTURE_2D),u.uniform1i(l["sampler"+t],t),e.nativeObject=n},b=function(){if(i.isDirty){var e=i.getTextures();for(var t=0;t<e.length;++t)(e[t].isDirty||!e[t].nativeObject)&&y(e[t],t);i.clearDirty()}};return{load:function(e){u=e,f=Viva.Graph.webgl(e),r=1024,i=new Viva.Graph.View.webglAtlas(r),o=f.createProgram(n,t),u.useProgram(o),l=f.getLocations(o,["a_vertexPos","a_customAttributes","u_screenSize","u_transform","u_sampler0","u_sampler1","u_sampler2","u_sampler3","u_tilesPerTexture"]),u.uniform1f(l.tilesPerTexture,r),u.enableVertexAttribArray(l.vertexPos),u.enableVertexAttribArray(l.customAttributes),a=u.createBuffer()},position:function(t,n){var r=t.id*e;p[r+0]=n.x-t.size,p[r+1]=n.y-t.size,p[r+2]=t._offset*4+0,p[r+3]=n.x+t.size,p[r+4]=n.y-t.size,p[r+5]=t._offset*4+1,p[r+6]=n.x-t.size,p[r+7]=n.y+t.size,p[r+8]=t._offset*4+2,p[r+9]=n.x-t.size,p[r+10]=n.y+t.size,p[r+11]=t._offset*4+2,p[r+12]=n.x+t.size,p[r+13]=n.y-t.size,p[r+14]=t._offset*4+1,p[r+15]=n.x+t.size,p[r+16]=n.y+t.size,p[r+17]=t._offset*4+3},createNode:function(t){p=f.extendArray(p,c,e),c+=1;var n=i.getCoordinates(t.src);n?t._offset=n.offset:(t._offset=0,i.load(t.src,function(e){t._offset=e.offset}))},removeNode:function(t){c>0&&(c-=1),t.id<c&&c>0&&(t.src&&i.remove(t.src),f.copyArrayPart(p,t.id*e,c*e,e))},replaceProperties:function(e,t){t._offset=e._offset},updateTransform:function(e){g=!0,m=e},updateSize:function(e,t){d=e,v=t,g=!0},render:function(){u.useProgram(o),u.bindBuffer(u.ARRAY_BUFFER,a),u.bufferData(u.ARRAY_BUFFER,p,u.DYNAMIC_DRAW),g&&(g=!1,u.uniformMatrix4fv(l.transform,!1,m),u.uniform2f(l.screenSize,d,v)),u.vertexAttribPointer(l.vertexPos,2,u.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),u.vertexAttribPointer(l.customAttributes,1,u.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,8),b(),u.drawArrays(u.TRIANGLES,0,c*6)}}},Viva.Graph.View=Viva.Graph.View||{},Viva.Graph.View.webglGraphics=function(e){e=e||{},e.enableBlending=typeof e.enableBlending!="boolean"?!0:e.enableBlending;var t,n,r,i,s,o=0,u=0,a,f,l,c=[],h=[],p,d=Viva.Graph.View.webglLinkProgram(),v=Viva.Graph.View.webglNodeProgram(),m=function(e){return Viva.Graph.View.webglSquare()},g=function(e){return Viva.Graph.View.webglLine(3014898687)},y=function(){d.updateTransform(a),v.updateTransform(a)},b=function(){a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},w=function(){t&&n&&(i=n.width=Math.max(t.offsetWidth,1),s=n.height=Math.max(t.offsetHeight,1),r&&r.viewport(0,0,i,s),d&&d.updateSize(i/2,s/2),v&&v.updateSize(i/2,s/2))},E=function(e){var t=o++,n=m(e);return n.id=t,v.createNode(n),c[t]=e,n},S=function(e){var t=u++,n=g(e);return n.id=t,d.createLink(n),h[t]=e,n},x=function(e){e.fire("rescaled")},T={node:function(e){return e&&typeof e!="function"?E(e):(m=e,this)},link:function(e){return e&&typeof e!="function"?S(e):(g=e,this)},placeNode:function(e){return f=e,this},placeLink:function(e){return l=e,this},inputManager:Viva.Input.webglInputManager,beginRender:function(){},endRender:function(){u>0&&d.render(),o>0&&v.render()},bringLinkToFront:function(e){var t=d.getFrontLinkId(),n,r;d.bringToFront(e),t>e.id&&(n=e.id,r=h[t],h[t]=h[n],h[t].ui.id=t,h[n]=r,h[n].ui.id=n)},graphCenterChanged:function(e,t){w()},translateRel:function(e,t){a[12]+=2*a[0]*e/i/a[0],a[13]-=2*a[5]*t/s/a[5],y()},scale:function(e,t){var n=2*t.x/i-1,r=1-2*t.y/s;return n-=a[12],r-=a[13],a[12]+=n*(1-e),a[13]+=r*(1-e),a[0]*=e,a[5]*=e,y(),x(this),a[0]},resetScale:function(){return b(),r&&(w(),y()),this},init:function(o){t=o,n=document.createElement("canvas"),w(),b(),t.appendChild(n),r=n.getContext("experimental-webgl");if(!r){var u="Could not initialize WebGL. Seems like the browser doesn't support it.";throw alert(u),u}e.enableBlending&&(r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enable(r.BLEND)),d.load(r),d.updateSize(i/2,s/2),v.load(r),v.updateSize(i/2,s/2),y(),typeof p=="function"&&p(n)},isSupported:function(){var e=document.createElement("canvas"),t=e&&e.getContext&&e.getContext("experimental-webgl");return t},initLink:function(e){},releaseLink:function(e){u>0&&(u-=1),d.removeLink(e);var t=e.id;if(t<u){if(u===0||u===t)return;h[t]=h[u],h[t].ui.id=t}},initNode:function(e){},releaseNode:function(e){o>0&&(o-=1),v.removeNode(e);if(e.id<o){var t=e.id;if(o===0||o===t)return;var n=c[o],r=c[t];c[t]=n,c[t].ui.id=t,v.replaceProperties(r.ui,n.ui)}},updateNodePosition:function(e,t){t.y=-t.y,f&&f(e,t),v.position(e,t)},updateLinkPosition:function(e,t,n){t.y=-t.y,n.y=-n.y,l&&l(e,t,n),d.position(e,t,n)},getGraphicsRoot:function(e){return typeof e=="function"&&(n?e(n):p=e),n},setNodeProgram:function(e){if(!r&&e)v=e;else if(e)throw"Not implemented. Cannot swap shader on the fly... yet."},setLinkProgram:function(e){if(!r&&e)d=e;else if(e)throw"Not implemented. Cannot swap shader on the fly... yet."},getGraphCoordinates:function(e){return e.x=2*e.x/i-1,e.y=1-2*e.y/s,e.x=(e.x-a[12])/a[0],e.y=(e.y-a[13])/a[5],e.x*=i/2,e.y*=-s/2,e}};return Viva.Graph.Utils.events(T).extend(),T},Viva.Graph.webglInputEvents=function(e,t){if(e.webglInputEvents)return e.webglInputEvents;var n=function(e,t,n){if(e.ui&&e.ui.size){var r=e.position,i=e.ui.size;return r.x-i<t&&t<r.x+i&&r.y-i<n&&n<r.y+i}return!0},r=null,i=Viva.Graph.spatialIndex(t,n),s=[],o=[],u=[],a=[],f=[],l=[],c=[],h=Viva.Graph.Utils.events(window.document),p,d=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},v=function(e){return d(e),!1},m=function(e,t){var n,r;for(n=0;n<e.length;n+=1){r=e[n].apply(undefined,t);if(r)return!0}},g=function(t){var n={x:0,y:0},g=null,y=+(new Date),b=function(e){m(f,[g,e]),n.x=e.clientX,n.y=e.clientY},w=function(e){h.stop("mousemove",b),h.stop("mouseup",w)},E=function(){boundRect=t.getBoundingClientRect()};window.addEventListener("resize",E),E(),t.addEventListener("mousemove",function(t){if(r)return;var u=!1,a;n.x=t.clientX-boundRect.left,n.y=t.clientY-boundRect.top,e.getGraphCoordinates(n),a=i.getNodeAt(n.x,n.y),a&&g!==a?(g=a,u=u||m(s,[g])):(!a||g!==a)&&a===null&&g!==a&&(u=u||m(o,[g]),g=null),u&&d(t)}),t.addEventListener("mousedown",function(t){var r=!1,s;n.x=t.clientX-boundRect.left,n.y=t.clientY-boundRect.top,e.getGraphCoordinates(n),s=[i.getNodeAt(n.x,n.y),t],s[0]?(r=m(u,s),h.on("mousemove",b),h.on("mouseup",w),p=document.onselectstart,prevDragStart=document.ondragstart,document.onselectstart=v,g=s[0]):g=null,r&&d(t)}),t.addEventListener("mouseup",function(t){var r=+(new Date),s;n.x=t.clientX-boundRect.left,n.y=t.clientY-boundRect.top,e.getGraphCoordinates(n),s=[i.getNodeAt(n.x,n.y),t],s[0]&&(document.onselectstart=p,r-y<400&&s[0]===g?cancelBubble=m(c,s):cancelBubble=m(l,s),y=r,m(a,s)&&d(t))})};return e.getGraphicsRoot(g),e.webglInputEvents={mouseEnter:function(e){return typeof e=="function"&&s.push(e),this},mouseLeave:function(e){return typeof e=="function"&&o.push(e),this},mouseDown:function(e){return typeof e=="function"&&u.push(e),this},mouseUp:function(e){return typeof e=="function"&&a.push(e),this},mouseMove:function(e){return typeof e=="function"&&f.push(e),this},click:function(e){return typeof e=="function"&&l.push(e),this},dblClick:function(e){return typeof e=="function"&&c.push(e),this},mouseCapture:function(e){r=e},releaseMouseCapture:function(e){r=null}},e.webglInputEvents},Viva.Input=Viva.Input||{},Viva.Input.webglInputManager=function(e,t){var n=Viva.Graph.webglInputEvents(t,e),r=null,i={},s={x:0,y:0};return n.mouseDown(function(e,t){r=e,s.x=t.clientX,s.y=t.clientY,n.mouseCapture(r);var o=i[e.ui.id];return o&&o.onStart&&o.onStart(t,s),!0}).mouseUp(function(e){n.releaseMouseCapture(r),r=null;var t=i[e.ui.id];return t&&t.onStop&&t.onStop(),!0}).mouseMove(function(e,t){if(r){var n=i[r.ui.id];return n&&n.onDrag&&n.onDrag(t,{x:t.clientX-s.x,y:t.clientY-s.y}),s.x=t.clientX,s.y=t.clientY,!0}}),{bindDragNDrop:function(e,t){i[e.ui.id]=t}}},Viva.Graph.View=Viva.Graph.View||{},Viva.Graph.View.renderer=function(e,t){var n=30;t=t||{};var r=t.layout,i=t.graphics,s=t.container,o,u,a=!1,f=!0,l=0,c=0,h=!1,p=!1,d={x:0,y:0},v={offsetX:0,offsetY:0,scale:1},m=function(){s=s||document.body,r=r||Viva.Graph.Layout.forceDirected(e),i=i||Viva.Graph.View.svgGraphics(e,{container:s}),typeof t.renderLinks=="undefined"&&(t.renderLinks=!0),t.prerender=t.prerender||0,o=(i.inputManager||Viva.Input.domListener)(e,i)},g={x:0,y:0,node:null},y={x:0,y:0,node:null},b={x:0,y:0},w=function(t){var n=e.getNode(t.fromId),r=e.getNode(t.toId);if(!n||!r)return;g.x=n.position.x,g.y=n.position.y,g.node=n,y.x=r.position.x,y.y=r.position.y,y.node=r,i.updateLinkPosition(t.ui,g,y)},E=function(e){b.x=e.position.x,b.y=e.position.y,i.updateNodePosition(e.ui,b)},S=function(){i.beginRender(),t.renderLinks&&!i.omitLinksRendering&&e.forEachLink(w),e.forEachNode(E),i.endRender()},x=function(){return h=r.step()&&!p,S(),!h},T=function(e){if(u){c+=e;return}e?(c+=e,u=Viva.Graph.Utils.timer(function(){return x()},n)):(l=0,c=0,u=Viva.Graph.Utils.timer(x,n))},N=function(){h=!1,u.restart()},C=function(){var e;if(typeof t.prerender=="number"&&t.prerender>0)for(e=0;e<t.prerender;e+=1)r.step();else r.step()},k=function(){var e=r.getGraphRect(),t=Viva.Graph.Utils.getDimension(s);d.x=d.y=0,v.offsetX=t.width/2-(e.x2+e.x1)/2,v.offsetY=t.height/2-(e.y2+e.y1)/2,i.graphCenterChanged(v.offsetX+d.x,v.offsetY+d.y),f=!1},L=function(e){var t=i.node(e);e.ui=t,i.initNode(t),r.addNode(e),E(e)},A=function(e){typeof e.ui!="undefined"&&(i.releaseNode(e.ui),e.ui=null,delete e.ui),r.removeNode(e)},O=function(e){var t=i.link(e);e.ui=t,i.initLink(t),i.omitLinksRendering||w(e)},M=function(e){typeof e.ui!="undefined"&&(i.releaseLink(e.ui),e.ui=null,delete e.ui)},_=function(e){var t=!1;o.bindDragNDrop(e,{onStart:function(){t=e.isPinned,e.isPinned=!0,p=!0,N()},onDrag:function(t,n){e.position.x+=n.x/v.scale,e.position.y+=n.y/v.scale,p=!0,S()},onStop:function(){e.isPinned=t,p=!1}})},D=function(e){o.bindDragNDrop(e,null)},P=function(){i.init(s),e.forEachNode(L),t.renderLinks&&e.forEachLink(O)},H=function(t){var n=t.node;t.changeType==="add"?(L(n),_(n),f&&k()):t.changeType==="remove"?(D(n),A(n),e.getNodesCount()===0&&(f=!0)):t.changeType==="update"},B=function(e){var n=e.link;e.changeType==="add"?(t.renderLinks&&O(n),r.addLink(n)):e.changeType==="remove"?(t.renderLinks&&M(n),r.removeLink(n)):e.changeType==="update"},j=function(){Viva.Graph.Utils.events(window).on("resize",function(){k(),x()});var t=Viva.Graph.Utils.dragndrop(s);t.onDrag(function(e,t){d.x+=t.x,d.y+=t.y,i.translateRel(t.x,t.y),S()}),t.onScroll(function(e,t,n){var r=Math.pow(1.4,t<0?-0.2:.2);v.scale=i.scale(r,n),S()}),e.forEachNode(_),Viva.Graph.Utils.events(e).on("changed",function(e){var t,n;for(t=0;t<e.length;t+=1)n=e[t],n.node?H(n):n.link&&B(n);N()})};return{run:function(e){return a||(m(),C(),k(),P(),j(),a=!0),T(e),this},reset:function(){i.resetScale(),k(),v.scale=1},pause:function(){u.stop()},resume:function(){u.restart()},rerender:function(){return S(),this}}},Viva.Graph.serializer=function(){var e=function(){if(typeof JSON=="undefined"||!JSON.stringify||!JSON.parse)throw"JSON serializer is not defined."},t=function(e){return{id:e.id,data:e.data}},n=function(e){return{fromId:e.fromId,toId:e.toId,data:e.data}},r=function(e){return e},i=function(e){return e};return{storeToJSON:function(r,i,s){if(!r)throw"Graph is not defined";e(),i=i||t,s=s||n;var o={nodes:[],links:[]};return r.forEachNode(function(e){o.nodes.push(i(e))}),r.forEachLink(function(e){o.links.push(s(e))}),JSON.stringify(o)},loadFromJSON:function(t,n,s){if(typeof t!="string")throw"String expected in loadFromJSON() method";e(),n=n||r,s=s||i;var o=JSON.parse(t),u=Viva.Graph.graph();if(!o||!o.nodes||!o.links)throw"Passed json string does not represent valid graph";for(var a=0;a<o.nodes.length;++a){var f=n(o.nodes[a]);if(!f.hasOwnProperty("id"))throw"Graph node format is invalid. Node.id is missing";u.addNode(f.id,f.data)}for(a=0;a<o.links.length;++a){var l=s(o.links[a]);if(!l.hasOwnProperty("fromId")||!l.hasOwnProperty("toId"))throw"Graph link format is invalid. Both fromId and toId are required";u.addLink(l.fromId,l.toId,l.data)}return u}}}