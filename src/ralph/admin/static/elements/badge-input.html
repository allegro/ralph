<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-input/iron-input.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">


<dom-module id='badge-input'>
  <template>
    <style>
    :host > div {
        border: solid blue 1px;
      @apply(--layout-horizontal);
      @apply(--layout-wrap);
    }
    #badgeContainer {
      border: solid black 1px;
      @apply(--layout-horizontal);
      @apply(--layout-wrap);
    }
    .container {
      @apply(--layout-horizontal);
      @apply(--layout-wrap);
    }
    #input-wrapper {
      border: solid yellow 1px;

/*
      :host {
      }
      .badge {
        background-color: #ededed;
      }
      .badge * {
        float: left;
        margin: 0 5px;
      }
      #text-getter{
        height: 28px;
        border: 0;
        background: #fff;
      }
      .badge, #text-getter{
        float: left;
        width: auto;
      }
      */
    </style>

    <div id='xxx'>
      <div id='badgeContainer'>
        <template is='dom-repeat' items="[[badgesData]]">
          <div class='badge'>
            <span>[[item.__str__]]</span>
            <!--
            TODO:: widget look
            -->
            <!-- yea, i know multi id is stupid, but django requires it :P -->
            <a class="related-widget-wrapper-link change-related"
              id="[[item.edit_icon_id]]"
              href='[[item.edit_url]]'
            >
              <i class="fa fa-pencil"></i>
            </a>
            <i on-tap="onBadgeRemove" class="fa fa-times delete"></i>
          </div>
        </template>
      </div>
      <div id='input-wrapper'>
        <input id='text-getter' is="iron-input">
      </div>
    <div>
    <div style="clear: both;"></div>

  </template>

  <script>
    Polymer({
      is: "badge-input",
      properties: {
        badgesData: {
          type: Array,
          value: function(){return [];}
        }
      },
      addBadge: function(badgeObject) {
        console.log('addBadge', badgeObject);
        this.push('badgesData', badgeObject);
        this.clearInput();
      },
      setBadges: function(badges) {
        console.log('setBadges', badges);
        this.badgesData = badges;
        this.clearInput();
      },
      onBadgeRemove: function(evt, obj) {
        console.log('onBadgeRemove', evt, obj);
        this.splice('badgesData', evt.model.index, 1);
        this.fire('badge-remove', {
            "index": evt.model.index,
            "item": evt.model.item
        });
      },
      setFocusInput: function() {
        console.log('setFocusInput');
        this.$['text-getter'].focus();
      },
      clear: function() {
        console.log('clear');
        this.set('badgesData', []);
      },
      // Down from here could be replaced if value attrib. is exposed
      clearInput: function() {
        console.log('clearInput');
        this.$['text-getter'].value = '';
      },
      getValue: function(text) {
        console.log('getValue', text);
        return this.$['text-getter'].value;
      },
      appendToInput: function(text) {
        console.log('appendToInput', text);
        this.$['text-getter'].value = this.$['text-getter'].value + text;
      },
      ready: function() {
      }
    });
  </script>
</dom-module>
