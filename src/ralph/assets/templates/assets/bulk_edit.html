{% extends 'assets/base.html' %}

{% block extra_headers %}
<style type="text/css">
  #float_toolbar{
    position: absolute;
    left: 0px;
    top: 0px;
    padding: 5px;
    background-color: black;
    border: solid #000 1px;
    border-radius: 3px;
    display: none;
  }
</style>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script type='text/javascript'>
  $("input[type=text].span12").click(function(event) {
    var toolbar = $("#float_toolbar");
    var offset = $(this).offset();
    var width = this.clientWidth;
    var distance_left = width + 10;
    if (this.id === '') {
      $(toolbar).data('input_name', this.name);
    }
    else {
      $(toolbar).data('input_id', this.id);
    }
    //toolbar.css("position", "absolute");
    toolbar.css("left", parseInt(offset.left) + distance_left + "px");
    toolbar.css("top", parseInt(offset.top) + "px");
    toolbar.css("display", "block");
  });

  $("#fill_all_rows").click(function(event) {
    var MAX_ROWS = 100;
    var input_id = $("#float_toolbar").data('input_id');
    var input_name = $("#float_toolbar").data('input_name');
    var matcher = /(.*)-([0-9]+)-(.*)/;
    var results, pre, number, post, value_to_fill, el;

    if (input_id) {
      results = matcher.exec(input_id);
      value_to_fill = $('#'+input_id).val();
    } else if (input_name) {
      // date picker
      results = matcher.exec(input_name);
      value_to_fill = $('input[name="'+input_name+'"]').val();
    }

    pre = results[1];
    number = results[2];
    post = results[3];
    for (var i=0; i < MAX_ROWS; i++) {
        if (input_id) {
          el = $('#' + pre + "-" + i + "-" + post);
        }
        else {
          el = $('input[name="' + pre + "-" + i + "-" + post + '"]');
        }
        if (!el.length) {
        break;
      }
      el.val(value_to_fill);
    }
  });

</script>
{% endblock scripts %}

{% block content %}
<div id="float_toolbar">
  <a id='fill_all_rows' href='#' style='color: white'>
    Fill all column
  </a>
</div>

<div class="row"><h3>Bulk edit</h3></div>

<form action="" method="POST" class="form form-inline">
  {% csrf_token %}
  {{ formset.management_form }}
  <div class="row">
      <table class="table table-striped table-bordered table-condensed">
      <thead><tr>
        <th></th>
        <th>Type</th>
        <th>Model</th>
        <th>Invoice Number</th>
        <th>Order Number</th>
        <th>Invoice date</th>
        <th>SN</th>
        <th>Barcode</th>
        <th width="20">Support period</th>
        <th>Support type</th>
        <th width="20">Support void reporting</th>
        <th>Provider</th>
        <th>Source</th>
        <th>Status</th>
      </tr></thead>
      <tbody>{% for form in formset %}
        <tr>
          <td style="vertical-align:middle">
            {{ forloop.counter }}
            {{ form.id }}
            {{ form.device_info }}
          </td>
          {% for field in form %}
            {% if "-device_info" in field.html_name or "-id" in field.html_name %}
              {# do nothing... #}
            {% elif "-barcode" in field.html_name  %}
              <td class="control-group{% if form.device_info.value and field.errors %} error{% endif %}" style="vertical-align:middle">
                {% if form.device_info.value %}
                  {{ field }}
                  {% if field.errors %}
                    <span class="help-inline">{% for error in field.errors %}{{ error }} {% endfor %}</span>
                  {% endif %}
                {% endif %}
              </td>
            {% else %}
              <td class="control-group{% if "-support_period" in field.html_name %} small{% endif %}{% if field.errors %} error{% endif %}" style="vertical-align:middle">
                {{ field }}
                {% if field.errors %}
                  <span class="help-inline">{% for error in field.errors %}{{ error }} {% endfor %}</span>
                {% endif %}
              </td>
            {% endif %}
          {% endfor %}
        </tr>
      {% endfor %}</tbody>
    </table>
  </div>
  <div class="row">
    <div class="form-actions">
      <button type="submit" class="btn btn-primary">Save</button>
    </div>
  </div>
</form>
{% endblock %}

