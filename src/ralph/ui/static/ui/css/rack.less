@max-u: 48;
@rack-border-width: 4px;
@rack-width: 350px;
@pdu-width: 50px;
@listing-u-width: 25px;
@devices-width-back: (@rack-width - (@pdu-width * 2) - (@listing-u-width * 2));
@devices-width-front: (@rack-width - (@listing-u-width * 2));
@device-background: rgb(147, 217, 50);
@u-height: 15px;
@info-padding: 3px;

* {
    box-sizing: border-box;
}

.generate-racks(@n, @i: 1) when (@i =< @n) {
  &.rack-u-@{i} .wrapper {
    height: @u-height * @i;
  }
  .generate-racks(@n, (@i + 1));
}

.generate-u(@n, @i: 1) when (@i =< @n) {
  &.height-u-@{i} {
    height: @u-height * @i;
  }
  .generate-u(@n, (@i + 1));
}

.generate-position(@n, @i: 1) when (@i =< @n) {
  &.position-u-@{i} {
    bottom: @u-height * (@i - 1);
  }
  .generate-position(@n, (@i + 1));
}

.rack-info {
    float: left;
    width:200px;
    padding: 10px;
    marign:10px;
}

.racks .rack .wrapper .devices .device,
.racks .rack .wrapper .listing-u .position {
    .generate-position(@max-u);
}

.racks .rack .wrapper .devices .device.height-u-0 {
    z-index: 10000;
    background-color: #f33;
    height: @u-height;
}

.racks {
    float: left;
    .rack {
        border-radius: 5px;
        position: relative;
        border: @rack-border-width solid #444;
        background: #666;
        width: @rack-width;
        box-sizing: content-box;
        .name {
            font-size: 1.25em;
            color: #eee;
            font-weight: bold;
            text-align: center;
            border-bottom: 1px solid #666;
            box-shadow: 0 1px 1px #000;
            text-shadow: 2px 0 1px #000;
            height: 30px;
            line-height: 30px;
            position: relative;
        }
        & .name:after {
            position: absolute;
            right: 10px;
            font-size: .825em;
            display: inline-block;
        }
        &.front .wrapper .devices {
            width: @devices-width-front;
            .device {width: @devices-width-front;}
        }
        &.front .wrapper .listing-u {
            z-index: 1000;
            &.left {box-shadow: 1px 0 1px rgba(0, 0, 0, 0.6);}
            &.right {box-shadow: -1px 0 1px rgba(0, 0, 0, 0.6);}
        }
        &.front .wrapper .pdu {display: none;}
        &.front .name:after {content: "front";}
        &.back .name:after {content: "back";}
        &.back {margin-left: 10px;}
        .generate-racks(@max-u);
        .wrapper
        {
            margin-top: 2px;
            .listing-u {
                margin: 0;
                width: @listing-u-width;
                float: left;
                position: relative;
                min-height: 100%;
                height: 100%;
                .position {
                    font-size: .825em;
                    border-top: 1px solid #888;
                    border-bottom: 1px solid #000;
                    position: absolute;
                    height: @u-height;
                    line-height: @u-height;
                    color: #fff;
                    text-align: center;
                    width: @listing-u-width;
                    &.active {
                        @color: rgb(255, 128, 0);
                        border-top-color: lighten(@color, 10%);
                        border-bottom-color: darken(@color, 10%);
                        background: @color;
                    }
                }
            }
            .pdu {
                position: relative;
                background: #ccc;
                min-height: 100%;
                height: 100%;
                width: @pdu-width;
                float: left;
                z-index: 1000;
                &.left {box-shadow: 1px 0 1px rgba(0, 0, 0, 0.6);}
                &.right {box-shadow: -1px 0 1px rgba(0, 0, 0, 0.6);}
            }
            .devices {
                width: @devices-width-back;
                min-height: 100%;
                height: 100%;
                float: left;
                position: relative;
                .device {
                    cursor: pointer;
                    width: @devices-width-back;
                    position: absolute;
                    height: @u-height;
                    border-bottom: 1px solid darken(@device-background, 10%);
                    border-top: 1px solid lighten(@device-background, 10%);
                    background: @device-background;
                    &:hover {
                        background: lighten(@device-background, 10%);
                    }
                    &.active {
                        background: lighten(@device-background, 20%);
                        border-color: darken(@device-background, 20%);
                    }
                    &.empty {
                        background: #fff;
                        line-height: @u-height;
                        border-bottom-color: #bbb;
                        border-top-color: #ddd;
                        &:before, &:after {position: absolute; content:":";line-height: 1em;}
                        &:before {left:10px;}
                        &:after {right:10px;}
                        &:hover {background: #eee;}
                        &.active {background: #ddd;}
                    }
                    .generate-u(@max-u);
                    &.height-u-0 .sn, &.height-u-1 .sn {display: none;}
                    &.position-u-1 .info .barcode, &.position-u-1 .info .model {top:0;}
                    .info {
                        display: block;
                        color: #333;
                        line-height: 1em;
                        text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
                        font-size: .825em;
                        position: relative;
                        min-height: 100%;
                        .barcode, .model, .sn {position: absolute;}
                        .barcode {
                            right: @info-padding;
                            bottom: @info-padding;
                        }
                        .sn {
                            left: @info-padding;
                            bottom: @info-padding;
                        }
                        .model {
                            font-weight: bold;
                            left: @info-padding;
                            top:@info-padding;
                        }
                    }
                }
            }
        }
    }
}
